<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .info { background-color: #d1ecf1; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>Chat System Test</h1>
    
    <div class="test-section info">
        <h2>Test Overview</h2>
        <p>This page tests the new neighborhood-specific chat system implementation.</p>
        <p><strong>Features to test:</strong></p>
        <ul>
            <li>Three predefined chat rooms per neighborhood</li>
            <li>Role-based permissions (moderator, security company)</li>
            <li>Real-time messaging via Socket.IO</li>
            <li>Message persistence in MongoDB</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Backend API Tests</h2>
        <button class="btn-primary" onclick="testChatRooms()">Test Chat Rooms API</button>
        <button class="btn-primary" onclick="testMessagesAPI()">Test Messages API</button>
        <button class="btn-primary" onclick="testSocketConnection()">Test Socket.IO Connection</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>Database Schema Test</h2>
        <p>Verify the new MongoDB schemas are working:</p>
        <ul>
            <li>ChatRoom schema with neighborhood-specific rooms</li>
            <li>ChatMessage schema with role-based permissions</li>
            <li>User schema with security_company role</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Frontend Integration Test</h2>
        <p>To test the frontend integration:</p>
        <ol>
            <li>Navigate to the dashboard page</li>
            <li>Go to the Chat tab</li>
            <li>Verify three chat rooms are displayed for your neighborhood</li>
            <li>Test sending messages in General Discussion</li>
            <li>Test read-only access to Moderator Alerts and Security Alerts</li>
        </ol>
    </div>

    <script>
        const API_BASE = 'https://api-3ffpwchysq-uc.a.run.app';
        
        function logResult(message, type = 'info') {
            const resultsDiv = document.getElementById('api-results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            resultsDiv.appendChild(div);
        }

        async function testChatRooms() {
            try {
                logResult('Testing chat rooms API...', 'info');
                
                // This would need a real neighborhood ID for testing
                const response = await fetch(`${API_BASE}/api/chat/rooms/test-neighborhood-id`);
                
                if (response.ok) {
                    const rooms = await response.json();
                    logResult(`✅ Chat rooms API working. Found ${rooms.length} rooms.`, 'success');
                } else {
                    logResult(`❌ Chat rooms API failed: ${response.status}`, 'error');
                }
            } catch (error) {
                logResult(`❌ Chat rooms API error: ${error.message}`, 'error');
            }
        }

        async function testMessagesAPI() {
            try {
                logResult('Testing messages API...', 'info');
                
                const response = await fetch(`${API_BASE}/api/chat/messages/test-room-id`);
                
                if (response.ok) {
                    const messages = await response.json();
                    logResult(`✅ Messages API working. Found ${messages.length} messages.`, 'success');
                } else {
                    logResult(`❌ Messages API failed: ${response.status}`, 'error');
                }
            } catch (error) {
                logResult(`❌ Messages API error: ${error.message}`, 'error');
            }
        }

        function testSocketConnection() {
            try {
                logResult('Testing Socket.IO connection...', 'info');
                
                // This would need Socket.IO client library
                logResult('⚠️ Socket.IO test requires client library. Check browser console for connection.', 'info');
            } catch (error) {
                logResult(`❌ Socket.IO test error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html> 
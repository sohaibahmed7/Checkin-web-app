<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Check-In</title>
    <link rel="stylesheet" href="styles/dashboard.css?v=1.0.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/png" href="/favicon.png">
</head>
<body class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="index.html" class="logo" id="mainLogoLink">
                <h1>Check-In</h1>
            </a>
        </div>
        <nav class="sidebar-nav">
            <a href="#home" class="active" data-tab="home"><i class="fas fa-home"></i> Home</a>
            <a href="#live-map" data-tab="live-map"><i class="fas fa-globe"></i> Live Map</a>
            <a href="#chat" data-tab="chat"><i class="fas fa-comments"></i> Chat</a>
            <a href="#reports" data-tab="reports"><i class="fas fa-file-alt"></i> Reports</a>
            <a href="#contacts" data-tab="contacts"><i class="fas fa-address-book"></i> Key Contacts</a>
            <a href="#settings" data-tab="settings"><i class="fas fa-cog"></i> Settings</a>
            <a href="/pages/auth/login.html" id="sidebarLogoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="greeting">
                <h2 id="greeting-text">Good Morning, User!</h2>
                <p>Welcome back to your dashboard</p>
            </div>
            <div class="user-menu">
                <div class="user-avatar" id="userAvatar">
                    <img id="greetingBarAvatar" src="assets/avatar.svg" onerror="this.onerror=null; this.src='assets/avatar.svg';">
                </div>
            </div>
        </header>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Home Tab -->
            <div class="tab-pane active" id="home">
                <div class="dashboard-grid">
                    <!-- Upcoming Alerts Card -->
                    <section class="card alert-overview">
                        <h3><i class="fas fa-bell"></i> Alerts</h3>
                        <div class="alert-stack">
                            <a href="#chat" data-tab="chat" class="alert-link">
                                <div class="alert-item msg" style="width: 100%; min-width: 300px;">
                                    <div class="alert-icon">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <div class="alert-content">
                                        <p class="alert-title">{Message Title here}</p>
                                        <p class="alert-details">{Message description here}</p>
                                    </div>
                                    <span class="alert-time">2m ago</span>
                                </div>
                            </a>
                            <a href="#live-map" data-tab="live-map" class="alert-link">
                                <div class="alert-item suspicious" style="width: 100%; min-width: 300px;">
                                    <div class="alert-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="alert-content">
                                        <p class="alert-title">{Suspicious Activity title here}</p>
                                        <p class="alert-details">{Suspicious activity desc here}</p>
                                    </div>
                                    <span class="alert-time">15m ago</span>
                                </div>
                            </a>
                            <a href="" data-tab="" class="alert-link">
                                <div class="alert-item event" style="width: 100%; min-width: 300px;">
                                    <div class="alert-icon">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <div class="alert-content">
                                        <p class="alert-title">{Todays safety tip}</p>
                                        <p class="alert-details">{idk something other than events i am typing a very long message to see what a long description is going to look like and if it will mess something up im just going to keep going i want to make sure that i am writing css that will wrap the text properly and not look stupid. do we want to add a line limit to avoid messages this long?}</p>
                                    </div>
                                    <span class="alert-time">30 min ago</span>
                                </div>
                            </a>
                        </div>
                        <a href="#" class="view-more" data-navigate-to="reports">
                            View more alerts <i class="fas fa-chevron-right"></i>
                        </a>
                    </section>

                    <!-- Activity Overview Card -->
                    <section class="card activity-overview">
                        <div class="overview-header">
                            <h3><i class="fas fa-chart-bar"></i> Activity Overview</h3>
                            <a href="#" class="view-reports-btn" data-navigate-to="reports">
                                <i class="fas fa-external-link-alt"></i> Full Reports
                            </a>
                        </div>
                        <div class="chart-container">
                            <canvas id="activityChart"></canvas>
                        </div>
                        <div class="overview-stats">
                            <div class="stat-item">
                                <span class="stat-label">Today's Reports</span>
                                <span class="stat-value">12</span>
                                <span class="stat-change positive">+2 <i class="fas fa-arrow-up"></i></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Active Cases</span>
                                <span class="stat-value">5</span>
                                <span class="stat-change neutral">0 <i class="fas fa-minus"></i></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Response Rate</span>
                                <span class="stat-value">95%</span>
                                <span class="stat-change positive">+5% <i class="fas fa-arrow-up"></i></span>
                            </div>
                        </div>
                    </section>

                    <!-- Map Section -->
                    <section class="card map-section">
                        <div class="map-header">
                            <h3><i class="fas fa-map-marked-alt"></i> Your Neighborhood</h3>
                        </div>
                        <div class="map-toolbar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div class="map-filters" style="display: flex; gap: 1rem; align-items: center;">
                                <div class="filter-group">
                                    <select class="time-filter">
                                        <option value="all" selected>All time</option>
                                        <option value="24h">< 24h</option>
                                        <option value="7d">< 7 Days</option>
                                        <option value="30d">< 30 Days</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <div class="category-toggles">
                                        <button class="active" data-category="all">All</button>
                                        <button data-category="suspicious">Suspicious</button>
                                        <button data-category="break-enter">Break & Enter</button>
                                        <button data-category="fire">Fire</button>
                                        <button data-category="other">Other</button>
                                    </div>
                                </div>
                            </div>
                            <button class="ping-button" id="place-ping-fab-home">
                                <i class="fas fa-plus"></i> Place a Ping
                            </button>
                        </div>
                        <div id="map" class="map-container"></div>
                    </section>
                    <section>
                        <div class="card">
                            <div class="feed-header"><h4><i class="fas fa-bell"></i> Latest in your area</h4></div>
                            <div class="feed-items" id="recent-updates-container">
                        </div>
                        <a href="#" class="view-more" data-navigate-to="live-map">
                            View more pings <i class="fas fa-chevron-right"></i>
                        </a>
                    </section>
                </div>
            </div>

            <!-- Live Map Tab -->
            <div class="tab-pane" id="live-map">
                <div class="live-map-container">
                    <div class="live-map-header">
                        <div class="map-toolbar" style="display: flex; justify-content: space-between; align-items: center; margin-left: 1.5rem; margin-right: 1.5rem;">
                            <div class="map-filters" style="display: flex; gap: 1rem; align-items: center;">
                                <div class="filter-group">
                                    <select class="time-filter">
                                        <option value="all" selected>All time</option>
                                        <option value="24h">< 24h</option>
                                        <option value="7d">< 7 Days</option>
                                        <option value="30d">< 30 Days</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <div class="category-toggles">
                                        <button class="active" data-category="all">All</button>
                                        <button data-category="suspicious">Suspicious</button>
                                        <button data-category="break-enter">Break & Enter</button>
                                        <button data-category="fire">Fire</button>
                                        <button data-category="other">Other</button>
                                    </div>
                                </div>
                            </div>
                            <button class="ping-button" id="place-ping-fab-live">
                                <i class="fas fa-plus"></i> Place a Ping
                            </button>
                        </div>
                    </div>
                    
                    <div class="live-map-layout">
                        <!-- Map View -->
                        <div class="live-map-view">
                            <div id="live-map-full"></div>
                        </div>

                        <!-- Ping Details Column -->
                        <div class="ping-details-column">
                            <div class="ping-details-header">
                                <h3>Pings in your neighborhood</h3>
                            </div>
                            <div class="ping-details-container" id="ping-details-container"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Tab -->
            <div class="tab-pane" id="chat">
                <div class="chat-dashboard">
                    <!-- Recent Chats Panel -->
                    <div class="chat-list-panel">
                        <div class="chat-list-header">
                            <div class="search-container">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Search conversations...">
                            </div>
                            <button class="new-chat-btn" title="Start a new chat">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        <div class="chat-list">
                            <div class="chat-item active" data-chat-id="community-chat">
                                <div class="chat-item-avatar">
                                    <img src="assets/avatar.svg" onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                </div>
                                <div class="chat-item-content">
                                    <div class="chat-item-header">
                                        <span class="chat-item-name">Community Chat</span>
                                        <span class="chat-item-time">Now</span>
                                    </div>
                                    <p class="chat-item-preview">Welcome to the community chat!</p>
                                </div>
                            </div>
                            <div class="chat-item" data-chat-id="watch">
                                <div class="chat-item-avatar">
                                    <img src="assets/avatar.svg" onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                </div>
                                <div class="chat-item-content">
                                    <div class="chat-item-header">
                                        <span class="chat-item-name">Neighborhood Watch</span>
                                        <span class="chat-item-time">2m ago</span>
                                    </div>
                                    <p class="chat-item-preview">John: Starting evening patrol. All clear on east side.</p>
                                </div>
                            </div>
                            <div class="chat-item" data-chat-id="safety">
                                <div class="chat-item-avatar">
                                    <img src="assets/avatar.svg" alt="Safety Committee" onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                </div>
                                <div class="chat-item-content">
                                    <div class="chat-item-header">
                                        <span class="chat-item-name">Safety Committee</span>
                                        <span class="chat-item-time">15m ago</span>
                                    </div>
                                    <p class="chat-item-preview">Sarah: Updated emergency response plan attached for review</p>
                                </div>
                            </div>
                            <div class="chat-item" data-chat-id="events">
                                <div class="chat-item-avatar">
                                    <img src="assets/avatar.svg" alt="Community Events" onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                </div>
                                <div class="chat-item-content">
                                    <div class="chat-item-header">
                                        <span class="chat-item-name">Community Events</span>
                                        <span class="chat-item-time">30m ago</span>
                                    </div>
                                    <p class="chat-item-preview">ðŸŽ‰ Weekend farmers market: 20+ vendors confirmed!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Main Chat Panel -->
                    <div class="chat-main-panel">
                        <div class="chat-header" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span>Community Chat</span>
                            <button class="chat-info-btn" id="openChatInfoModal" title="Chat Info & Settings" style="background: #e0e7ff; border: 1px solid #4a6bff; color: #4a6bff; cursor: pointer; font-size: 1.2rem; padding: 0.3em 0.7em; border-radius: 6px; display: flex; align-items: center; gap: 0.3em;">
                                <i class="fas fa-info-circle"></i>
                                <span style="font-size:0.95em;">Info</span>
                            </button>
                        </div>
                        <div class="messages-container" id="messages">
                            <div class="loading">Loading messages...</div>
                        </div>
                        <div class="chat-input-area">
                            <button class="attach-button" title="Attach file">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off">
                            <button class="emoji-button" title="Add emoji">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button id="send-button">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane" id="reports">
                <div class="reports-dashboard">
                    <div class="reports-header">
                        <div class="reports-header-left">
                            <button class="quick-stats-btn">
                                <i class="fas fa-chart-line"></i> View Quick Stats
                            </button>
                        </div>
                        <div class="reports-header-right">
                            <button class="refresh-reports-btn" onclick="refreshReports()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div class="reports-overview">
                        <div class="activity-chart-section">
                            <div class="chart-header">
                                <h3><i class="fas fa-chart-bar"></i> Activity Overview</h3>
                                <div class="chart-filters">
                                    <button class="active">Week</button>
                                    <button>Month</button>
                                    <button>Year</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="reportsActivityChart"></canvas>
                            </div>
                            <div class="chart-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Total Reports</span>
                                    <span class="stat-value">124</span>
                                    <span class="stat-change positive">+12% <i class="fas fa-arrow-up"></i></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Response Time</span>
                                    <span class="stat-value">8m</span>
                                    <span class="stat-change negative">-5% <i class="fas fa-arrow-down"></i></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Resolution Rate</span>
                                    <span class="stat-value">92%</span>
                                    <span class="stat-change positive">+3% <i class="fas fa-arrow-up"></i></span>
                                </div>
                            </div>
                        </div>

                        <div class="activity-feed-section">
                            <div class="feed-header">
                                <h3><i class="fas fa-history"></i> Recent Activity</h3>
                                <div class="feed-filters">
                                    <button class="active"><i class="fas fa-clock"></i> Latest</button>
                                    <button><i class="fas fa-fire"></i> Urgent</button>
                                    <button><i class="fas fa-check-circle"></i> Resolved</button>
                                </div>
                            </div>
                            <div class="feed-items">
                                <div class="feed-item urgent">
                                    <div class="feed-avatar">
                                        <img src="assets/avatar.svg" alt="John D." onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                        <span class="status urgent"></span>
                                    </div>
                                    <div class="feed-content">
                                        <div class="feed-header">
                                            <span class="feed-user">John D.</span>
                                            <span class="feed-time">5m ago</span>
                                        </div>
                                        <p class="feed-text">Fire reported at Oak & Main. Fire department en route.</p>
                                        <div class="feed-actions">
                                            <a href="#map" class="view-on-map" data-coordinates="-81.24,43.02">
                                                <i class="fas fa-map-marker-alt"></i> View Location
                                            </a>
                                            <span class="feed-category fire">
                                                <i class="fas fa-fire"></i> Fire Alert
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="feed-item resolved">
                                    <div class="feed-avatar">
                                        <img src="assets/avatar.svg" alt="Sarah M." onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                        <span class="status resolved"></span>
                                    </div>
                                    <div class="feed-content">
                                        <div class="feed-header">
                                            <span class="feed-user">Sarah M.</span>
                                            <span class="feed-time">15m ago</span>
                                        </div>
                                        <p class="feed-text">Suspicious activity report resolved. Area secured by patrol.</p>
                                        <div class="feed-actions">
                                            <button class="feed-action">
                                                <i class="fas fa-check-circle"></i> Resolved
                                            </button>
                                            <span class="feed-category resolved">
                                                <i class="fas fa-shield-alt"></i> Case Closed
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="feed-item">
                                    <div class="feed-avatar">
                                        <img src="assets/avatar.svg" alt="Mike R." onerror="this.onerror=null;this.src='assets/avatar.svg';">
                                        <span class="status active"></span>
                                    </div>
                                    <div class="feed-content">
                                        <div class="feed-header">
                                            <span class="feed-user">Mike R.</span>
                                            <span class="feed-time">30m ago</span>
                                        </div>
                                        <p class="feed-text">Suspicious vehicle spotted - Silver van circling Elm Street.</p>
                                        <div class="feed-actions">
                                            <a href="#map" class="view-on-map" data-coordinates="-81.25,43.01">
                                                <i class="fas fa-map-marker-alt"></i> View Location
                                            </a>
                                            <span class="feed-category suspicious">
                                                <i class="fas fa-exclamation-triangle"></i> Under Investigation
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="reports-filters">
                    <div class="filter-group">
                        <label>Type</label>
                        <select class="type-filter">
                            <option value="all">All Types</option>
                            <option value="suspicious">Suspicious Activity</option>
                            <option value="break-enter">Break & Enter</option>
                            <option value="fire">Fire</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select class="status-filter">
                            <option value="all">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="investigating">Investigating</option>
                            <option value="active">Active</option>
                            <option value="solved">Solved</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Date Range</label>
                        <div class="date-range">
                            <input type="date" class="date-from" placeholder="From">
                            <input type="date" class="date-to" placeholder="To">
                        </div>
                    </div>
                </div>

                <div class="responsive-table-wrapper">
                    <div class="reports-table-container">
                        <table class="reports-table" id="reports-table">
                            <thead>
                                <tr>
                                    <th>Avatar<div class="resize-handle"></div></th>
                                    <th class="sortable" data-sort="reporter">Reporter <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th class="sortable" data-sort="type">Type <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th class="sortable" data-sort="description">Description <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th class="sortable" data-sort="date">Date <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th class="sortable status-col" data-sort="status">Status <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th class="sortable time-resolved-col" data-sort="timeResolved">Time Resolved <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th class="sortable" data-sort="evidence">Evidence <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reports-tbody">
                                <!-- Reports will be loaded dynamically -->
                                <tr class="loading-row">
                                    <td colspan="10" class="text-center">
                                        <div class="loading-spinner">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Loading reports...
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Report Details Modal -->
                <div id="reportDetailsModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Report Details</h3>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div id="reportDetailsContent"></div>
                        </div>
                    </div>
                </div>

                <!-- Add Note Modal -->
                <div id="addNoteModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add Note</h3>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="addNoteForm">
                                <div class="form-group">
                                    <label for="noteContent">Note Content:</label>
                                    <textarea id="noteContent" name="content" rows="4" required></textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn-secondary" onclick="closeModal('addNoteModal')">Cancel</button>
                                    <button type="submit" class="btn-primary">Add Note</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Add Follow-up Modal -->
                <div id="addFollowUpModal" class="modal followup-modal-wide followup-modal-polished">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title"><i class="fas fa-plus-circle"></i> Add Follow-up</h3>
                            <span class="close" onclick="closeModal('addFollowUpModal')">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="addFollowUpForm">
                                <div class="form-card">
                                    <label class="form-label" style="display:flex;align-items:center;gap:0.5em;">
                                        <span><i class="fas fa-tasks"></i> Type:</span>
                                        <span class="type-info-tooltip" title="Suggestion: propose a status or update. Evidence: upload proof or details."><i class="fas fa-info-circle"></i></span>
                                    </label>
                                    <div class="followup-type-toggle-horizontal">
                                        <label class="radio-label"><input type="radio" name="followupType" value="suggestion" checked> Suggestion</label>
                                        <label class="radio-label"><input type="radio" name="followupType" value="evidence"> Evidence</label>
                                    </div>
                                </div>
                                <div class="form-card" id="suggestionFields">
                                    <div class="section-header"><i class="fas fa-lightbulb"></i> Suggestion Type</div>
                                    <div class="form-group">
                                        <label class="form-label" for="followUpAction">Type:</label>
                                        <select id="followUpAction" name="action" required>
                                            <option value="Mark as Solved">Mark as Solved</option>
                                            <option value="Mark as Unsolved">Mark as Unsolved</option>
                                            <option value="Needs Attention">Needs Attention</option>
                                            <option value="General Update/Note">General Update/Note</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="suggestionCommentGroup">
                                        <label class="form-label" for="followUpDescription"><i class="fas fa-comment-dots"></i> Comment (optional):</label>
                                        <textarea id="followUpDescription" name="description" rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="form-card" id="evidenceFields" style="display:none;">
                                    <div class="section-header"><i class="fas fa-paperclip"></i> Evidence Upload</div>
                                    <div class="form-group">
                                        <label class="form-label" for="evidenceNote"><i class="fas fa-comment-dots"></i> Comment (optional):</label>
                                        <textarea id="evidenceNote" name="evidenceNote" rows="3" placeholder="Describe what you saw..."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="evidenceImage"><i class="fas fa-upload"></i> Upload Image:</label>
                                        <div class="evidence-upload-area" id="evidenceUploadArea">
                                            <input type="file" id="evidenceImage" name="evidenceImage" accept="image/*" style="display:none;">
                                            <div class="upload-placeholder">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <span>Drag & drop or <span class="upload-link">click to upload</span></span>
                                            </div>
                                            <div class="file-preview" id="evidenceFilePreview" style="display:none;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-actions followup-actions-row">
                                    <button type="button" class="btn-secondary followup-cancel-btn" onclick="closeModal('addFollowUpModal')">Cancel</button>
                                    <button type="submit" class="btn-primary followup-submit-btn">Add Follow-up</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Report Trail Modal -->
                <div id="reportTrailModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Report Trail</h3>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div id="reportTrailContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contacts Tab -->
            <div class="tab-pane" id="contacts">
                <div class="contacts-dashboard">
                    <div class="contacts-header">
                        <h2><i class="fas fa-address-book"></i> Key Contacts</h2>
                        <p>Essential numbers and people for your community's safety and support.</p>
                    </div>
                    <div class="contacts-section">
                        <h3><i class="fas fa-shield-alt"></i> Security Guard Company</h3>
                        <ul class="contacts-list">
                            <li><strong>Regular Security Guard:</strong> <a href="tel:+14165551234">+1 (416) 555-1234</a></li>
                            <li><strong>Security Manager:</strong> <a href="tel:+14165554321">+1 (416) 555-4321</a></li>
                        </ul>
                    </div>
                    <div class="contacts-section">
                        <h3><i class="fas fa-user-shield"></i> Moderators</h3>
                        <ul class="contacts-list">
                            <li><strong>Jane Doe (Lead Moderator):</strong> <a href="mailto:jane.doe@email.com">jane.doe@email.com</a></li>
                            <li><strong>John Smith (Moderator):</strong> <a href="mailto:john.smith@email.com">john.smith@email.com</a></li>
                        </ul>
                    </div>
                    <div class="contacts-section">
                        <h3><i class="fas fa-phone-alt"></i> Emergency Helplines</h3>
                        <ul class="contacts-list">
                            <li><strong>Fire Safety:</strong> <a href="tel:911">911</a></li>
                            <li><strong>Ontario Provincial Police (OPP):</strong> <a href="tel:+18883102222">+1 (888) 310-2222</a></li>
                            <li><strong>Local Police (Non-Emergency):</strong> <a href="tel:+14165550000">+1 (416) 555-0000</a></li>
                            <li><strong>Ambulance:</strong> <a href="tel:911">911</a></li>
                            <li><strong>General Emergency:</strong> <a href="tel:911">911</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane" id="settings">
                <div class="settings-dashboard">
                    <!-- Profile Preview Card -->
                    <div class="profile-preview-card">
                        <div class="profile-preview-avatar">
                            <img src="assets/avatar.svg" alt="User Avatar" onerror="this.onerror=null;this.src='assets/avatar.svg';">
                        </div>
                        <div class="profile-preview-info">
                            <h2>User Name</h2>
                            <p>user@example.com</p>
                        </div>
                    </div>

                    <!-- Account Settings -->
                    <div class="settings-section">
                        <h3>Account Settings</h3>
                        <form class="settings-form">
                            <div class="form-group">
                                <label for="name">Full Name</label>
                                <input type="text" id="name" value="User Name">
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" value="user@example.com" readonly>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" value="+1 (555) 123-4567">
                            </div>
                            <div class="form-group">
                                <label for="profilePicture">Profile Picture</label>
                                <div class="file-input-container">
                                    <label class="file-input-label" for="profilePicture">
                                        Choose File
                                    </label>
                                    <input type="file" id="profilePicture" name="profile_picture" class="file-input" accept="image/*">
                                </div>
                            </div>
                            <button type="button" class="change-password-btn">
                                <i class="fas fa-lock"></i> Change Password
                            </button>
                        </form>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings-section">
                        <h3>Notification Settings</h3>
                        <div class="toggle-group">
                            <span>Email Notifications</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <span>Push Notifications</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <span>Community Alerts</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="settings-section">
                        <h3>Privacy Settings</h3>
                        <div class="toggle-group">
                            <span>Show Location on Map</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <span>Share Activity Status</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Settings Actions -->
                    <div class="settings-actions">
                        <button class="cancel-button">Cancel</button>
                        <button class="save-button">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <script src="/config.js"></script>
    <script src="scripts/dashboard.js"></script>

    <div id="placePingModal" class="pin-modal">
        <div class="pin-modal-content card">
            <div class="pin-modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0; color: var(--primary-color); font-weight: 600;">Place a Ping</h3>
                <button id="closePingModal" class="close-modal" style="background:none;border:none;font-size:1.5rem;cursor:pointer;line-height:1;">&times;</button>
            </div>
            <form id="pingForm" class="pin-modal-form">
                <div class="form-group">
                    <label for="pingAddressSearch">Search Address</label>
                    <input type="text" id="pingAddressSearch" placeholder="Search for an address or nearby location..." autocomplete="off" style="width:100%;padding:0.75rem;border:1px solid var(--light-gray);border-radius:8px;font-size:0.95rem;background:var(--white);">
                    <div id="pingAddressSuggestions" style="position:relative;"></div>
                </div>
                <div class="form-group">
                    <label for="pingMapPreview">Select Location</label>
                    <div id="pingMapPreview" style="width:100%;height:140px;background:#f5f5f5;border-radius:10px;margin-bottom:0.5rem;"></div>
                </div>
                <div class="form-group">
                    <label for="pingDescription">Description</label>
                    <textarea id="pingDescription" name="description" placeholder="What's happening?" style="width:100%;"></textarea>
                </div>
                <div class="form-group">
                    <label for="pingCategory">Type of Ping</label>
                    <select id="pingCategory" name="type" required style="width:100%;padding:0.75rem;border:1px solid var(--light-gray);border-radius:8px;font-size:0.95rem;background:var(--white);">
                        <option value="">Select a type</option>
                        <option value="suspicious">Suspicious</option>
                        <option value="break-enter">Break & Enter</option>
                        <option value="fire">Fire</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pingPhoto">Photo (optional)</label>
                    <input type="file" id="pingPhoto" name="photo" accept="image/*">
                </div>
                <div class="form-group" style="display:none;">
                    <input type="hidden" id="ping-lat" name="lat">
                    <input type="hidden" id="ping-lng" name="lng">
                </div>
                <div class="pin-modal-actions" style="display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem;">
                    <button type="button" id="cancelPingBtn" class="cancel-button modal-action-btn">Cancel</button>
                    <button type="submit" class="save-button modal-action-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="scripts/chat.js"></script>

    <script>
        // Personalize greeting based on time and user name
        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Good Morning';
            if (hour < 18) return 'Good Afternoon';
            return 'Good Evening';
        }
        // Get user's name from localStorage
        const user = JSON.parse(localStorage.getItem('user'));
        const userName = user && user.name ? user.name : 'User';
        document.getElementById('greeting-text').textContent = `${getGreeting()}, ${userName}!`;

        const sidebarLogoutBtn = document.getElementById('sidebarLogoutBtn');
        const mainLogoLink = document.getElementById('mainLogoLink');

        // Ensure sidebar logout clears user data and redirects
        if (sidebarLogoutBtn) {
            sidebarLogoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('user');
                window.location.href = '/pages/auth/login.html';
            });
        }

        // Ensure logo always redirects to landing page
        if (mainLogoLink) {
            mainLogoLink.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'index.html';
            });
        }

        // Add event listener for Cancel button to close the modal
        const cancelPingBtn = document.getElementById('cancelPingBtn');
        const placePingModal = document.getElementById('placePingModal');
        if (cancelPingBtn && placePingModal) {
            cancelPingBtn.addEventListener('click', function() {
                placePingModal.classList.remove('active');
            });
        }
    </script>

    <!-- Place this just before </body> -->
    <div id="chatInfoModal" class="modal" style="display:none;">
        <div class="modal-content chat-info-modal-content">
            <span class="close-button" id="closeChatInfoModal">&times;</span>
            <h2>Chat Settings</h2>
            <form id="chatSettingsForm">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div class="chat-pfp-container">
                        <img id="chatPfpPreview" src="assets/avatar.svg" alt="Chat Profile Picture" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;" onerror="this.onerror=null;this.src='assets/avatar.svg';">
                        <input type="file" id="chatPfpInput" accept="image/*" style="display:none;">
                        <button type="button" id="changeChatPfpBtn" style="margin-top: 0.5rem;">Change</button>
                    </div>
                    <div style="flex:1;">
                        <label for="chatName">Chat Name</label>
                        <input type="text" id="chatName" value="Community Chat" style="width:100%; margin-bottom:0.5rem;">
                        <label for="chatDesc">Description</label>
                        <input type="text" id="chatDesc" value="" placeholder="Add a description..." style="width:100%;">
                    </div>
                </div>
                <h3>Members <span id="onlineCount" style="font-size:0.9rem; color:var(--text-muted);"></span></h3>
                <ul id="chatMembersList" style="list-style:none; padding:0; margin-bottom:1rem;">
                    <!-- Members will be populated here -->
                </ul>
                <div style="display:flex; justify-content:flex-end; gap:1rem;">
                    <button type="button" id="cancelChatSettingsBtn" class="cancel-button">Cancel</button>
                    <button type="submit" class="save-button">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sign Out Confirmation Modal -->
    <div id="signoutModal" class="modal">
      <div class="modal-content">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-color);">Are you sure you want to log out?</h3>
        <div class="modal-actions">
          <button id="cancelSignoutBtn" class="modal-action-btn cancel-button" style="background: var(--white); color: var(--text-color); border: 1px solid var(--light-gray);">Cancel</button>
          <button id="confirmSignoutBtn" class="modal-action-btn logout-button">Log Out</button>
        </div>
      </div>
    </div>
</body>
</html> 